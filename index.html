<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no">
  <title>♥청첩장♥</title>
  <link href='./css/main.css' rel='stylesheet' type='text/css'>
  <script type="text/javascript" src="./js/image_model.js"></script>
  <script type="text/javascript" src="./js/load_images.js"></script>
  <script type="text/javascript" src="./js/draw_images.js"></script>
  <script type="text/javascript" src="./js/entry_battle.js"></script>
</head>

<body>
<div id="loadingLayer">
  <img src="./img/loading_pika.gif" width="100"><br>
  청첩장을 만나러 가는중입니다.
</div>
<canvas id="my_canvas"></canvas>
</body>

<script>
window.onload = function() {
  init();

  loadImages()
  .then(hideLoading)
  .then(drawEntryBattle)
  .then(drawWhatToDo)
  .then(() => {
    choiceBox();
    choiceText();
  });
};


function init() {
  window.canvas = document.getElementById("my_canvas");

  // 클릭 이벤트 발행
  canvas.addEventListener('click', action, false);

  canvas.width  = window.innerWidth;
  canvas.height = window.innerHeight;

  window.ctx = canvas.getContext('2d');
}

function showLoading() {
  document.getElementById("loadingLayer").style.display = "";
}

function hideLoading() {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      document.getElementById("loadingLayer").style.display = "none";
      resolve();
    }, 2000);
  });
}

function action(e) {
  // 텍스트 기본 높이
  let textHeigh = 15;
  let p = getCursorPosition(e);
  console.log(p);

  // 내용 읽기
  if (p.x >= readRect.x && p.x <= readRect.x + readRect.w 
    && p.y >= readRect.y - textHeigh && p.y <= readRect.y + readRect.h - textHeigh
  ) {
    console.log("read");
  } 

  // 약도 보기
  if (p.x >= mapRect.x && p.x <= mapRect.x + mapRect.w 
    && p.y >= mapRect.y - textHeigh && p.y <= mapRect.y + mapRect.h - textHeigh
  ) {
    console.log("map");
  } 

  // 참석하기
  if (p.x >= attendRect.x && p.x <= attendRect.x + attendRect.w 
    && p.y >= attendRect.y - textHeigh && p.y <= attendRect.y + attendRect.h - textHeigh
  ) {
    console.log("attend");
  } 

  // 도망가기
  if (p.x >= runRect.x && p.x <= runRect.x + runRect.w 
    && p.y >= runRect.y - textHeigh && p.y <= runRect.y + runRect.h - textHeigh
  ) {
    console.log("run");
  } 
}

// 클릭 좌표 계산기
function getCursorPosition(event) {
    var rect = canvas.getBoundingClientRect();
    var x = event.clientX - rect.left;
    var y = event.clientY - rect.top;
    return {
      x: x,
      y: y
    };
}


</script>
</html>